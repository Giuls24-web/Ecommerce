<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carrito | FloriLuz</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <div class="promo-strip">âœ¨ EnvÃ­o <strong>gratis</strong> en pedidos sobre $50 Â· LÃ¡mparas artesanales Ãºnicas ðŸŒ¸</div>

    <nav class="navbar">
        <a href="index.html" class="navbar-brand">
            <div class="logo-icon">ðŸŒ¸</div>
            FloriLuz
        </a>
        <ul class="navbar-links" id="nav-links">
            <li><a href="index.html">
                    <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
                        <polyline points="9 22 9 12 15 12 15 22" />
                    </svg>
                    Inicio
                </a></li>
            <li><a href="products.html">
                    <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="3" width="7" height="7" />
                        <rect x="14" y="3" width="7" height="7" />
                        <rect x="14" y="14" width="7" height="7" />
                        <rect x="3" y="14" width="7" height="7" />
                    </svg>
                    CatÃ¡logo
                </a></li>
            <li>
                <a href="cart.html" class="nav-cart active">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="9" cy="21" r="1" />
                        <circle cx="20" cy="21" r="1" />
                        <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6" />
                    </svg>
                    Carrito
                    <span class="cart-badge" id="cart-count">0</span>
                </a>
            </li>
        </ul>
        <button class="nav-toggle" id="nav-toggle"><span></span><span></span><span></span></button>
    </nav>

    <div class="cart-page">
        <div class="page-header">
            <h1>ðŸ›’ Tu Carrito</h1>
            <p>Revisa tus lÃ¡mparas seleccionadas antes de confirmar</p>
        </div>

        <!-- Estado vacÃ­o -->
        <div id="cart-empty" style="display:none">
            <div class="cart-empty">
                <div class="empty-emoji">ðŸŒ¸</div>
                <h3>Tu carrito estÃ¡ vacÃ­o</h3>
                <p>Descubre nuestras hermosas lÃ¡mparas florales</p>
                <a href="products.html" class="btn btn-primary">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="3" width="7" height="7" />
                        <rect x="14" y="3" width="7" height="7" />
                        <rect x="14" y="14" width="7" height="7" />
                        <rect x="3" y="14" width="7" height="7" />
                    </svg>
                    Ver CatÃ¡logo
                </a>
            </div>
        </div>

        <!-- Layout principal -->
        <div id="cart-main" style="display:none">
            <div class="cart-layout">

                <!-- Columna izquierda: items -->
                <div class="cart-items-col" id="cart-items"></div>

                <!-- Columna derecha: resumen + checkout -->
                <div class="cart-summary-col">
                    <!-- Resumen -->
                    <div class="cart-summary-box">
                        <div class="summary-title">Resumen del pedido</div>
                        <div class="summary-line"><span>Subtotal</span><span id="subtotal">$0.00</span></div>
                        <div class="summary-line"><span>Descuento</span><span style="color:#2d8a57">$0.00</span></div>
                        <div class="summary-line total"><span>Total</span><span id="total-price">$0.00</span></div>
                        <div class="free-ship">
                            <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <rect x="1" y="3" width="15" height="13" />
                                <polygon points="16 8 20 8 23 11 23 16 16 16 16 8" />
                                <circle cx="5.5" cy="18.5" r="2.5" />
                                <circle cx="18.5" cy="18.5" r="2.5" />
                            </svg>
                            Â¡EnvÃ­o gratis incluido! ðŸŽ‰
                        </div>
                        <button class="btn btn-ghost btn-sm" style="width:100%;justify-content:center;margin-top:.5rem"
                            onclick="clearCart()">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <polyline points="3 6 5 6 21 6" />
                                <path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6" />
                                <path d="M10 11v6" />
                                <path d="M14 11v6" />
                                <path d="M9 6V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2" />
                            </svg>
                            Vaciar carrito
                        </button>
                    </div>

                    <!-- Formulario de checkout -->
                    <div class="checkout-box">
                        <div class="checkout-title">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                fill="none" stroke="#c97d8a" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" />
                                <circle cx="12" cy="10" r="3" />
                            </svg>
                            Datos de entrega
                        </div>

                        <div class="form-group">
                            <label>
                                <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                                    <circle cx="12" cy="7" r="4" />
                                </svg>
                                Nombre completo *
                            </label>
                            <input type="text" id="name" placeholder="MarÃ­a GarcÃ­a">
                        </div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round">
                                        <path
                                            d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" />
                                        <polyline points="22,6 12,13 2,6" />
                                    </svg>
                                    Correo *
                                </label>
                                <input type="email" id="email" placeholder="correo@ejemplo.com">
                            </div>
                            <div class="form-group">
                                <label>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round">
                                        <path
                                            d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07A19.5 19.5 0 0 1 4.69 13.1 19.79 19.79 0 0 1 1.61 4.5 2 2 0 0 1 3.59 2.27h3a2 2 0 0 1 2 1.72c.127.96.361 1.903.7 2.81a2 2 0 0 1-.45 2.11L7.91 9.91a16 16 0 0 0 6.16 6.16l.95-.95a2 2 0 0 1 2.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0 1 21.73 17z" />
                                    </svg>
                                    TelÃ©fono
                                </label>
                                <input type="tel" id="phone" placeholder="+593 99 999 9999">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>
                                <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
                                    <polyline points="9 22 9 12 15 12 15 22" />
                                </svg>
                                DirecciÃ³n completa *
                            </label>
                            <input type="text" id="address" placeholder="Calle, nÃºmero, apartamento">
                        </div>
                        <div class="form-group">
                            <label>
                                <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10" />
                                    <line x1="2" y1="12" x2="22" y2="12" />
                                    <path
                                        d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z" />
                                </svg>
                                Ciudad *
                            </label>
                            <input type="text" id="city" placeholder="Quito">
                        </div>

                        <button class="btn btn-primary"
                            style="width:100%;justify-content:center;margin-top:.8rem;padding:1rem"
                            onclick="placeOrder()">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <polyline points="20 6 9 17 4 12" />
                            </svg>
                            Confirmar Pedido
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Cargando -->
        <div id="cart-loading" class="loading-state">
            <div class="loading-spinner"></div>
            Cargando carrito...
        </div>

        <!-- Orden exitosa -->
        <div id="order-success" style="display:none">
            <div class="order-success">
                <div class="success-icon">ðŸŽ‰</div>
                <h2>Â¡Pedido Confirmado!</h2>
                <p>Tu orden ha sido registrada exitosamente.</p>
                <div class="order-id-badge" id="order-id-text"></div>
                <p>Te contactaremos pronto para coordinar la entrega ðŸŒ¸</p>
                <a href="index.html" class="btn btn-primary" style="margin-top:1.5rem">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
                        <polyline points="9 22 9 12 15 12 15 22" />
                    </svg>
                    Volver al Inicio
                </a>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <footer class="footer">
        <p>ðŸŒ¸ <strong>FloriLuz</strong> â€” LÃ¡mparas Florales Artesanales</p>
        <p class="footer-sub">Proyecto E-commerce en Go Â· Tercer Semestre Â· 2024</p>
    </footer>

    <script>
        const API = 'http://localhost:8080/api';

        document.addEventListener('DOMContentLoaded', () => {
            loadCart();
            const toggle = document.getElementById('nav-toggle');
            const links = document.getElementById('nav-links');
            toggle.addEventListener('click', () => {
                links.classList.toggle('open');
                toggle.classList.toggle('open');
            });
        });

        async function loadCart() {
            show('cart-loading');
            try {
                const res = await fetch(`${API}/cart`);
                const json = await res.json();
                if (!json.success) throw new Error(json.error);
                renderCart(json.data);
            } catch (e) {
                hide('cart-loading');
                show('cart-empty');
            }
        }

        function renderCart(cart) {
            hide('cart-loading');
            const items = cart.items || [];
            if (!items.length) { show('cart-empty'); return; }
            show('cart-main');

            const emojis = { rosa: 'ðŸŒ¹', girasol: 'ðŸŒ»', loto: 'ðŸª·', margarita: 'ðŸŒ¼' };
            document.getElementById('cart-items').innerHTML = items.map(item => `
    <div class="cart-item">
      <div class="cart-item-img">
        ${item.image_url
                    ? `<img src="${item.image_url}" alt="${item.product_name}" onerror="this.parentElement.innerHTML='ðŸŒ¸'">`
                    : 'ðŸŒ¸'}
      </div>
      <div class="cart-item-info">
        <div class="cart-item-name">${item.product_name}</div>
        <div class="cart-item-meta">$${item.price.toFixed(2)} Ã— ${item.quantity} unidades</div>
      </div>
      <div class="cart-item-right">
        <div class="cart-item-subtotal">$${(item.price * item.quantity).toFixed(2)}</div>
        <button class="btn btn-danger" onclick="removeItem('${item.product_id}')">
          <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
        </button>
      </div>
    </div>`).join('');

            const subtotal = items.reduce((s, i) => s + i.price * i.quantity, 0);
            document.getElementById('subtotal').textContent = `$${subtotal.toFixed(2)}`;
            document.getElementById('total-price').textContent = `$${subtotal.toFixed(2)}`;
            document.getElementById('cart-count').textContent = items.reduce((s, i) => s + i.quantity, 0);
        }

        async function removeItem(pid) {
            try {
                const res = await fetch(`${API}/cart/remove`, {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ product_id: pid })
                });
                const json = await res.json();
                if (!json.success) { showToast('âŒ ' + json.error, 'error'); return; }
                hide('cart-main'); hide('cart-empty');
                renderCart(json.data);
                showToast('ðŸ—‘ï¸ Producto eliminado', '');
            } catch (e) { showToast('âŒ Error de conexiÃ³n', 'error'); }
        }

        async function clearCart() {
            if (!confirm('Â¿Vaciar el carrito?')) return;
            try {
                await fetch(`${API}/cart/clear`, { method: 'POST' });
                hide('cart-main');
                show('cart-empty');
                document.getElementById('cart-count').textContent = '0';
                showToast('ðŸ—‘ï¸ Carrito vaciado', '');
            } catch (e) { showToast('âŒ Error', 'error'); }
        }

        async function placeOrder() {
            const customer = {
                name: document.getElementById('name').value.trim(),
                email: document.getElementById('email').value.trim(),
                phone: document.getElementById('phone').value.trim(),
                address: document.getElementById('address').value.trim(),
                city: document.getElementById('city').value.trim()
            };
            if (!customer.name || !customer.email || !customer.address || !customer.city) {
                showToast('âŒ Completa todos los campos obligatorios', 'error');
                return;
            }
            try {
                const res = await fetch(`${API}/orders`, {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(customer)
                });
                const json = await res.json();
                if (!json.success) { showToast('âŒ ' + json.error, 'error'); return; }
                hide('cart-main');
                document.getElementById('order-id-text').textContent =
                    `Orden ${json.data.id} Â· Total $${json.data.total.toFixed(2)}`;
                show('order-success');
                document.getElementById('cart-count').textContent = '0';
            } catch (e) { showToast('âŒ Error de conexiÃ³n', 'error'); }
        }

        function show(id) { document.getElementById(id).style.display = 'block'; }
        function hide(id) { document.getElementById(id).style.display = 'none'; }
        function showToast(msg, type = '') {
            const t = document.getElementById('toast');
            t.textContent = msg;
            t.className = `toast ${type} show`;
            setTimeout(() => { t.className = 'toast'; }, 3200);
        }
    </script>
</body>

</html>