<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FloriLuz ‚Äî L√°mparas Florales Artesanales</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
</head>

<body>

    <!-- PROMO STRIP -->
    <div class="promo-strip">‚ú® Env√≠o <strong>gratis</strong> en pedidos sobre $50 ¬∑ L√°mparas artesanales √∫nicas üå∏</div>

    <!-- NAVBAR -->
    <nav class="navbar">
        <a href="index.html" class="navbar-brand">
            <div class="logo-icon">üå∏</div>
            FloriLuz
        </a>

        <ul class="navbar-links" id="nav-links">
            <li><a href="index.html" class="active">
                    <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
                        <polyline points="9 22 9 12 15 12 15 22" />
                    </svg>
                    Inicio
                </a></li>
            <li><a href="products.html">
                    <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="3" width="7" height="7" />
                        <rect x="14" y="3" width="7" height="7" />
                        <rect x="14" y="14" width="7" height="7" />
                        <rect x="3" y="14" width="7" height="7" />
                    </svg>
                    Cat√°logo
                </a></li>
            <li>
                <a href="cart.html" class="nav-cart">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="9" cy="21" r="1" />
                        <circle cx="20" cy="21" r="1" />
                        <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6" />
                    </svg>
                    Carrito
                    <span class="cart-badge" id="cart-count">0</span>
                </a>
            </li>
        </ul>

        <button class="nav-toggle" id="nav-toggle" aria-label="Men√∫">
            <span></span><span></span><span></span>
        </button>
    </nav>

    <!-- HERO -->
    <section class="hero">
        <div class="hero-text">
            <div class="hero-eyebrow">Colecci√≥n 2024</div>
            <h1>Ilumina tu hogar<br>con alma <em>floral</em></h1>
            <p>L√°mparas artesanales inspiradas en la naturaleza. Cada pieza es √∫nica, dise√±ada para transformar tu
                espacio en un jard√≠n luminoso.</p>
            <div class="hero-actions">
                <a href="products.html" class="btn btn-primary">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="11" cy="11" r="8" />
                        <line x1="21" y1="21" x2="16.65" y2="16.65" />
                    </svg>
                    Explorar Colecci√≥n
                </a>
                <a href="#destacados" class="btn btn-outline">Ver destacados</a>
            </div>
        </div>
        <div class="hero-visual">
            <div class="hero-card">
                <div class="hero-card-emoji">üåπ</div>
                <div class="hero-card-name">L√°mpara Rosa Rom√°ntica</div>
                <div class="hero-card-price">$49.99</div>
                <div class="hero-card-badge">‚≠ê M√°s vendida</div>
            </div>
        </div>
    </section>

    <!-- PRODUCTOS DESTACADOS -->
    <section class="section" id="destacados">
        <div class="section-header">
            <div class="section-label">Nuestra Colecci√≥n</div>
            <h2 class="section-title">L√°mparas <em>Florales</em></h2>
            <p class="section-sub">Cada l√°mpara est√° inspirada en una flor diferente</p>
        </div>

        <div class="categories-tabs">
            <button class="cat-tab active" onclick="filterProducts(this, '')">üå∏ Todas</button>
            <button class="cat-tab" onclick="filterProducts(this, 'rosa')">üåπ Rosas</button>
            <button class="cat-tab" onclick="filterProducts(this, 'girasol')">üåª Girasoles</button>
            <button class="cat-tab" onclick="filterProducts(this, 'loto')">ü™∑ Lotos</button>
            <button class="cat-tab" onclick="filterProducts(this, 'margarita')">üåº Margaritas</button>
        </div>

        <div class="products-grid" id="products-grid">
            <div class="loading-state">
                <div class="loading-spinner"></div>
                Cargando l√°mparas...
            </div>
        </div>
    </section>

    <!-- TOAST -->
    <div class="toast" id="toast"></div>

    <!-- FOOTER -->
    <footer class="footer">
        <p>üå∏ <strong>FloriLuz</strong> ‚Äî L√°mparas Florales Artesanales</p>
        <p class="footer-sub">Proyecto E-commerce en Go ¬∑ Tercer Semestre ¬∑ 2024</p>
    </footer>

    <script>
        const API = 'http://localhost:8080/api';

        document.addEventListener('DOMContentLoaded', () => {
            loadProducts();
            loadCartCount();

            // Hamburger menu
            const toggle = document.getElementById('nav-toggle');
            const links = document.getElementById('nav-links');
            toggle.addEventListener('click', () => {
                links.classList.toggle('open');
                toggle.classList.toggle('open');
            });
        });

        async function loadProducts(category = '') {
            const grid = document.getElementById('products-grid');
            grid.innerHTML = '<div class="loading-state"><div class="loading-spinner"></div>Cargando...</div>';
            try {
                const url = category ? `${API}/products?category=${category}` : `${API}/products`;
                const res = await fetch(url);
                const json = await res.json();
                if (!json.success) throw new Error(json.error);
                const products = json.data || [];
                if (!products.length) {
                    grid.innerHTML = '<div class="loading-state">Sin productos en esta categor√≠a üå∏</div>';
                    return;
                }
                grid.innerHTML = products.map(renderCard).join('');
            } catch (e) {
                grid.innerHTML = `<div class="loading-state" style="color:#c0392b">
      Error al conectar con el servidor.<br>
      <small style="opacity:.7">¬øEst√° corriendo <code>go run main.go</code>?</small>
    </div>`;
            }
        }

        function renderCard(p) {
            const em = { rosa: 'üåπ', girasol: 'üåª', loto: 'ü™∑', margarita: 'üåº' }[p.category] || 'üå∏';
            const lowStock = p.stock > 0 && p.stock <= 3;
            return `
    <div class="product-card">
      <div class="product-img-wrap">
        ${p.image_url
                    ? `<img src="${p.image_url}" alt="${p.name}" onerror="this.parentElement.innerHTML='<div class=product-img-fallback>${em}</div>'">`
                    : `<div class="product-img-fallback">${em}</div>`}
        <span class="product-badge">${em} ${p.category}</span>
        ${lowStock ? `<span class="product-badge-low">¬°Solo ${p.stock}!</span>` : ''}
      </div>
      <div class="product-body">
        <div class="product-name">${p.name}</div>
        <div class="product-desc">${p.description}</div>
        <div class="qty-row">
          <button class="qty-btn" onclick="chg('q${p.id}',-1)">‚àí</button>
          <input class="qty-input" id="q${p.id}" type="number" value="1" min="1" max="${p.stock}">
          <button class="qty-btn" onclick="chg('q${p.id}',1)">+</button>
        </div>
        <div class="product-footer-row">
          <div class="product-price">$${p.price.toFixed(2)}</div>
          <button class="btn btn-primary btn-sm" onclick="addToCart('${p.id}','q${p.id}')" ${p.stock === 0 ? 'disabled style="opacity:.4"' : ''}>
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg>
            ${p.stock === 0 ? 'Sin stock' : 'Agregar'}
          </button>
        </div>
      </div>
    </div>`;
        }

        function chg(id, d) {
            const el = document.getElementById(id);
            el.value = Math.max(1, parseInt(el.value || 1) + d);
        }

        async function addToCart(pid, qid) {
            const qty = parseInt(document.getElementById(qid)?.value || 1);
            try {
                const res = await fetch(`${API}/cart/add`, {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ product_id: pid, quantity: qty })
                });
                const json = await res.json();
                if (!json.success) { showToast('‚ùå ' + json.error, 'error'); return; }
                const count = json.data.items.reduce((s, i) => s + i.quantity, 0);
                document.getElementById('cart-count').textContent = count;
                showToast('‚úÖ ¬°L√°mpara agregada al carrito!', 'success');
            } catch (e) { showToast('‚ùå Error de conexi√≥n', 'error'); }
        }

        function filterProducts(btn, cat) {
            document.querySelectorAll('.cat-tab').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            loadProducts(cat);
        }

        async function loadCartCount() {
            try {
                const res = await fetch(`${API}/cart`);
                const json = await res.json();
                if (json.success && json.data.items) {
                    document.getElementById('cart-count').textContent =
                        json.data.items.reduce((s, i) => s + i.quantity, 0);
                }
            } catch (e) { }
        }

        function showToast(msg, type = '') {
            const t = document.getElementById('toast');
            t.textContent = msg;
            t.className = `toast ${type} show`;
            setTimeout(() => { t.className = 'toast'; }, 3200);
        }
    </script>
</body>

</html>